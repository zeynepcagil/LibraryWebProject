@model List<Library_Project.Models.Book>

@{
    ViewData["Title"] = "Library Dashboard";

    // Doluluk oranı simülasyonu (İlerde veritabanından çekilebilir)
    int currentOccupancy = 70;
    int capacity = 100;
    int percentage = (int)((double)currentOccupancy / capacity * 100);
    string progressColor = percentage > 90 ? "bg-danger" : (percentage > 70 ? "bg-warning" : "bg-success");
}

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-end mb-4">
        <div>
            <h2 class="fw-bold text-primary"><i class="fas fa-book-reader me-2"></i>Library Search</h2>
            <p class="text-muted mb-0">Find your next favorite book from our collection.</p>
        </div>

        <div class="card border-0 shadow-sm" style="min-width: 250px;">
            <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="text-uppercase text-muted fw-bold" style="font-size: 0.75rem;">Live Occupancy</span>
                    <span class="badge bg-success bg-opacity-10 text-success border border-success">
                        <i class="fas fa-door-open me-1"></i> Open
                    </span>
                </div>
                <div class="d-flex align-items-baseline">
                    <h3 class="mb-0 fw-bold text-dark me-2" style="font-size: 2rem;">@currentOccupancy</h3>
                    <span class="text-muted">/ @capacity Seats</span>
                </div>
                <div class="progress mt-2" style="height: 8px; border-radius: 4px;">
                    <div class="progress-bar @progressColor" role="progressbar" style="width: @percentage%"></div>
                </div>
                <small class="text-muted mt-1 d-block" style="font-size: 0.75rem;">
                    @if (percentage > 90)
                    {
                        <span class="text-danger"><i class="fas fa-exclamation-triangle"></i> High Traffic</span>
                    }
                    else
                    {

                        <span><i class="fas fa-check-circle text-success"></i> Plenty of space</span>
                    }
                </small>
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-sm mb-4 bg-light">
        <div class="card-body p-4">
            <form method="get" class="row g-3">
                <div class="col-md-5">
                    <label class="form-label fw-bold text-secondary small">Search Term</label>
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                        <input type="text" name="search" value="@Context.Request.Query["search"]" class="form-control border-start-0" placeholder="Title, Author..." />
                    </div>
                </div>

                <div class="col-md-3">
                    <label class="form-label fw-bold text-secondary small">Category</label>
                    <select name="category" class="form-select">
                        <option value="">All Categories</option>
                        @if (ViewBag.Categories != null)
                        {
                            @foreach (var cat in ViewBag.Categories)
                            {
                                <option value="@cat">@cat</option>
                            }
                        }
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="form-label fw-bold text-secondary small">Rating</label>
                    <select name="minRating" class="form-select">
                        <option value="">Any</option>
                        <option value="7">7+ Good</option>
                        <option value="8">8+ Very Good</option>
                        <option value="9">9+ Excellent</option>
                    </select>
                </div>

                <div class="col-md-2 d-flex align-items-end">
                    <button class="btn btn-primary w-100 fw-bold">
                        <i class="fas fa-filter me-2"></i> Filter
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow border-0 overflow-hidden">
        <table class="table table-hover align-middle mb-0">
            <thead class="bg-primary text-white">
                <tr>
                    <th class="py-3 ps-4">Book Title</th>
                    <th class="py-3">Author</th>
                    <th class="py-3">Category</th>
                    <th class="py-3">Rating</th>
                    <th class="py-3">Stock Status</th>
                    <th class="py-3 text-end pe-4">Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var book in Model)
                {
                    <tr>
                        <td class="ps-4">
                            <div class="d-flex align-items-center">
                                <div class="bg-light rounded p-2 me-3 text-primary">
                                    <i class="fas fa-book fa-lg"></i>
                                </div>
                                <a asp-controller="Book" asp-action="Details" asp-route-id="@book.BOOK_ID" class="text-decoration-none text-dark fw-bold">
                                    @book.TITLE
                                </a>
                            </div>
                        </td>
                        <td class="text-secondary">@book.AUTHOR</td>
                        <td><span class="badge bg-light text-dark border">@book.CATEGORY</span></td>
                        <td>
                            <div class="text-warning small">
                                <span class="fw-bold text-dark me-1">@book.RATING</span>
                                <i class="fas fa-star"></i>
                            </div>
                        </td>
                        <td>
                            @if (book.STOCK > 0)
                            {
                                <span class="badge bg-success-subtle text-success border border-success">
                                    Available (@book.STOCK)
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-danger-subtle text-danger border border-danger">Out of Stock</span>
                            }
                        </td>
                        <td class="text-end pe-4">
                            <a asp-controller="Book" asp-action="Details" asp-route-id="@book.BOOK_ID" class="btn btn-sm btn-outline-primary rounded-pill px-3">
                                View <i class="fas fa-arrow-right ms-1"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        @if (!Model.Any())
        {
            <div class="text-center py-5">
                <i class="fas fa-search fa-3x text-muted mb-3 opacity-25"></i>
                <p class="text-muted">No books found matching your criteria.</p>
            </div>
        }
    </div>

</div>